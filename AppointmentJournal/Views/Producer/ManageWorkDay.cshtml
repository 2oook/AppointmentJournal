@model ManageWorkDayViewModel

@{
    ViewBag.Title = Constants.AppNameUpperCase;
    ViewBag.PageType = "Управление рабочим днём";
}

<div class="m-1 p-1 d-inline-block ">

    @if (Model.AppointmentTimesList.Count != 0 & Model.WorkDay != null)
    {
        @foreach (var appointmentTimeList in Model.AppointmentTimesList)
        {
            <div class="d-flex flex-wrap border p-1 m-1">
                <div class="d-flex flex-wrap">
                    @foreach (var appointmentTime in appointmentTimeList.Value)
                    {
                        if (appointmentTime.IsAvailable)
                        {
                            <form asp-controller="Consumer" asp-action="Book">
                                <input type="hidden" name="chosenTime" value="@appointmentTime.Time" />
                                <input type="hidden" name="serviceId" value="@Model.ServiceId" />
                                <button type="submit" class="btn btn-success p-2 m-1">
                                    @appointmentTime.Time.ToShortTimeString()
                                </button>
                            </form>
                        }
                        else
                        {
                            <button class="btn btn-sm btn-secondary p-2 m-1">
                                @appointmentTime.Time.ToShortTimeString()
                            </button>
                        }
                    }
                </div>

                <div class="badge">
                    <form asp-controller="Producer" asp-action="RemoveWorkDayTimeSpan" method="post">
                        <input type="hidden" name="serviceId" value="@Model.ServiceId" />
                        <input type="hidden" name="workDayTimeSpanId" value="@appointmentTimeList.Key.Id" />
                        <input type="hidden" name="returnUrl" value="@ViewContext.HttpContext.Request.PathAndQuery()" />
                        <button type="submit" class="btn btn-danger p-2">
                            Удалить период
                        </button>
                    </form>
                </div>
            </div>
        }

        <div class="d-flex border p-1 m-1">
            <form asp-controller="Producer" asp-action="ToggleWorkDayAvailability" method="post">
                <input type="hidden" name="workDayId" value="@Model.WorkDay.Id" />
                <input type="hidden" name="returnUrl" value="@ViewContext.HttpContext.Request.PathAndQuery()" />

                @if (Model.WorkDay.IsEnabled)
                {
                    <button type="submit" class="btn btn-warning p-2 m-1">
                        Закрыть день для записи
                    </button>
                }
                else
                {
                    <button type="submit" class="btn btn-info p-2 m-1">
                        Открыть день для записи
                    </button>
                }

            </form>
        </div>
    }

    <div class="border p-1 m-1">
        <form asp-controller="Producer" asp-action="AddWorkDaySpan" method="get">
            <input type="hidden" name="serviceId" value="@Model.ServiceId" />
            <input type="hidden" name="chosenDateInTicks" value="@Model.ChosenDate.Ticks" />
            <input type="hidden" name="returnUrl" value="@ViewContext.HttpContext.Request.PathAndQuery()" />

            <button type="submit" class="btn btn-primary p-2 m-1">
                Добавить период рабочего времени
            </button>
        </form>
    </div>

</div>
